const avoidanceColorMap=Object.fromEntries(avoidanceConfig.map(e=>[e.name,e.color])),avoidanceDifficultyMap=Object.fromEntries(avoidanceConfig.map((e,t)=>[e.name,t]));let tableData=[],headers=[],currentSort={index:null,asc:!1},showRatings=!1;const ahofTable=document.getElementById("ahof"),ahofThead=ahofTable.querySelector("thead"),ahofTbody=ahofTable.querySelector("tbody");ahofTbody.addEventListener("click",e=>{const t=e.target.closest(".ahof-game-link");if(t){const e=t.dataset.game;return void(window.location.href=`clears.html?game=${encodeURIComponent(e)}`)}const a=e.target.closest(".clickable-cell");if(a){const e=a.dataset.player,t=a.dataset.game;window.location.href=`clears.html?player=${encodeURIComponent(e)}&game=${encodeURIComponent(t)}`}}),document.querySelectorAll('input[name="view-mode"]').forEach(e=>{e.addEventListener("change",e=>{showRatings="ratings"===e.target.value,ahofTable.classList.toggle("ratings-mode",showRatings),ahofTable.classList.toggle("clears-mode",!showRatings),renderTable()})}),fetch("data/ahof.json").then(e=>e.json()).then(e=>{headers=e.headers,tableData=e.data.filter(e=>""!==e[0]),renderTable(),document.getElementById("loader").classList.add("hidden"),document.getElementById("ahof").classList.remove("hidden"),ahofTable.classList.add("clears-mode")}).catch(e=>{document.getElementById("loader").innerHTML="<p style='color:red;'>Failed to load table.</p>",console.error(e)});const avatarToggleAHoF=document.getElementById("toggle-avatars-ahof");function renderTable(){ahofThead.textContent="",ahofTbody.textContent="";const e=document.createElement("tr"),t=document.createElement("th");t.textContent="#",e.appendChild(t);const a=document.createElement("th");if(a.textContent="Game",a.style.cursor="pointer",a.onclick=()=>sortTable(1),e.appendChild(a),showRatings){headers.slice(1,10).forEach((t,a)=>{const n=document.createElement("th");n.textContent=t,n.style.cursor="pointer",n.onclick=()=>sortTable(a+2),e.appendChild(n)})}else["First Clear","Latest Clear","Total Clears"].forEach((t,a)=>{const n=document.createElement("th");n.textContent=t,"Total Clears"===t&&(n.style.cursor="pointer",n.onclick=()=>sortTable(14)),e.appendChild(n)});ahofThead.appendChild(e);const n=document.createDocumentFragment();for(let e=0;e<tableData.length;e++){const t=tableData[e],a=document.createElement("tr"),o=document.createElement("td");o.textContent=e+1,a.appendChild(o);const r=t[0],l=document.createElement("td"),c=document.createElement("span");c.textContent=r,c.className="ahof-game-link",c.dataset.game=r;const s=avoidanceColorMap[r];if(s&&(l.style.backgroundColor=s,l.style.color=getContrastTextColor(s)),l.appendChild(c),a.appendChild(l),showRatings)for(let e=1;e<=9;e++){const n=t[e],o=document.createElement("td");if("N/A"===n)o.textContent="N/A";else if(isNaN(n)||""===n)o.textContent=n;else{const t=parseFloat(n);o.textContent=t.toFixed(2),applyRatingColor(o,e,t)}a.appendChild(o)}else{const e=t[10]?"https://images.hsingh.app/?url="+t[10]+"&w=28&output=webp":"assets/images/default.webp",n=t[11]||"-",o=t[12]?"https://images.hsingh.app/?url="+t[12]+"&w=28&output=webp":"assets/images/default.webp",l=t[13]||"-",c=t[14]||"0",s=document.createElement("td");if("-"!==n){const t=document.createElement("div");t.className="player-cell";const a=document.createElement("img");a.className="avatar-img",a.loading="lazy",a.decoding="async",a.referrerPolicy="no-referrer",a.src=e,a.width="28",a.height="28",a.alt="Avatar",a.onerror=()=>a.src="assets/images/default.webp";const o=document.createElement("span");o.textContent=n,o.className="clickable-cell",o.dataset.player=n,o.dataset.game=r,t.appendChild(a),t.appendChild(o),s.appendChild(t)}else s.textContent="-";a.appendChild(s);const d=document.createElement("td");if("-"!==l){const e=document.createElement("div");e.className="player-cell";const t=document.createElement("img");t.className="avatar-img",t.loading="lazy",t.decoding="async",t.referrerPolicy="no-referrer",t.src=o,t.width="28",t.height="28",t.alt="Avatar",t.onerror=()=>t.src="assets/images/default.webp";const a=document.createElement("span");a.textContent=l,a.className="clickable-cell",a.dataset.player=l,a.dataset.game=r,e.appendChild(t),e.appendChild(a),d.appendChild(e)}else d.textContent="-";a.appendChild(d);const i=document.createElement("td");i.textContent=c,a.appendChild(i)}n.appendChild(a)}ahofTbody.appendChild(n)}function sortTable(e){if(0===e)return;if(1===e)return tableData.sort((e,t)=>{const a=avoidanceDifficultyMap[e[0]],n=avoidanceDifficultyMap[t[0]];return void 0===a&&void 0===n?0:void 0===a?1:void 0===n?-1:a-n}),void renderTable();if(!showRatings)return 14===e?(currentSort.index===e?currentSort.asc=!currentSort.asc:(currentSort.index=e,currentSort.asc=!1),tableData.sort((e,t)=>{const a=parseInt(e[14])||0,n=parseInt(t[14])||0;return currentSort.asc?a-n:n-a}),void renderTable()):void 0;const t=e-1;currentSort.index===e?currentSort.asc=!currentSort.asc:(currentSort.index=e,currentSort.asc=!1),tableData.sort((e,a)=>{const n=e[t],o=a[t];return"N/A"===n?1:"N/A"===o?-1:isNaN(n)||isNaN(o)?currentSort.asc?String(n).localeCompare(String(o)):String(o).localeCompare(String(n)):currentSort.asc?parseFloat(n)-parseFloat(o):parseFloat(o)-parseFloat(n)}),renderTable()}function clamp(e,t,a){return Math.max(t,Math.min(a,e))}function interpolateRGB(e,t,a){return`rgb(${Math.round(e[0]+(t[0]-e[0])*a)},${Math.round(e[1]+(t[1]-e[1])*a)},${Math.round(e[2]+(t[2]-e[2])*a)})`}function normalizeRating(e){return clamp(e,0,10)/10}function getBlueRedColor(e){return interpolateRGB([0,0,255],[255,0,0],normalizeRating(e))}function getRedGreenColor(e){return interpolateRGB([255,0,0],[32,172,23],normalizeRating(e))}function applyRatingColor(e,t,a){t>=1&&t<=7?e.style.color=getBlueRedColor(a):8!==t?9===t&&(e.style.color=getRedGreenColor(a)):e.style.fontWeight="600"}avatarToggleAHoF?.addEventListener("change",()=>{ahofTable.classList.toggle("hide-avatars",!avatarToggleAHoF.checked)});
